use strict;
use warnings;
use utf8;
use Test::More;

BEGIN {
	use_ok 'Text::UnicodeBox::Table';
};

$Text::UnicodeBox::Utility::report_on_failure = 1;

my @columns = qw(id ts log);
my @rows = (
	[ 1, '2012-04-16 12:34:16', 'blakblkj welkjwe' ],
	[ 2, '2012-04-16 16:30:43', 'Eric was here' ],
	[ 3, '2012-04-16 16:31:43', 'Eric was here again' ],
);

my $table = Text::UnicodeBox::Table->new();
isa_ok $table, 'Text::UnicodeBox::Table';

$table->add_header({ style => 'heavy' }, @columns);
$table->add_row(@$_) foreach @rows;

is "\n" . $table->render, <<END_BOX, "Sample MySQL table output";

\x{250f}\x{2501}\x{2501}\x{2501}\x{2501}\x{2533}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2533}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2513}
\x{2503} id \x{2503} ts                  \x{2503} log                 \x{2503}
\x{2521}\x{2501}\x{2501}\x{2501}\x{2501}\x{2547}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2547}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2501}\x{2529}
\x{2502}  1 \x{2502} 2012-04-16 12:34:16 \x{2502} blakblkj welkjwe    \x{2502}
\x{2502}  2 \x{2502} 2012-04-16 16:30:43 \x{2502} Eric was here       \x{2502}
\x{2502}  3 \x{2502} 2012-04-16 16:31:43 \x{2502} Eric was here again \x{2502}
\x{2514}\x{2500}\x{2500}\x{2500}\x{2500}\x{2534}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2534}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2518}
END_BOX

{
	my $alt_table = Text::UnicodeBox::Table->new( style => 'heavy_header' );
	$alt_table->add_header(@columns);
	$alt_table->add_row(@$_) foreach @rows;
	is $alt_table->render, $table->render, "Style: heavy_header";
}

$table = Text::UnicodeBox::Table->new();

$table->add_header({ top => 'double', bottom => 'double' }, @columns);
$table->add_row(@{ $rows[0] });
$table->add_row(@{ $rows[1] });
$table->add_row({ bottom => 'double' }, @{ $rows[2] });

is "\n" . $table->render, <<END_BOX, "Different take on the rendering";

\x{2552}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2555}
\x{2502} id \x{2502} ts                  \x{2502} log                 \x{2502}
\x{255e}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2561}
\x{2502}  1 \x{2502} 2012-04-16 12:34:16 \x{2502} blakblkj welkjwe    \x{2502}
\x{2502}  2 \x{2502} 2012-04-16 16:30:43 \x{2502} Eric was here       \x{2502}
\x{2502}  3 \x{2502} 2012-04-16 16:31:43 \x{2502} Eric was here again \x{2502}
\x{2558}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{255b}
END_BOX

{
	my $alt_table = Text::UnicodeBox::Table->new( style => 'horizontal_double' );
	$alt_table->add_header(@columns);
	$alt_table->add_row(@$_) foreach @rows;
	is $alt_table->render, $table->render, "Style: horizontal_double";
}

$table = Text::UnicodeBox::Table->new();

$table->add_header({ top => 'double', bottom => 'double' }, @columns);
$table->add_row({ bottom => 'light' }, @{ $rows[0] });
$table->add_row({ bottom => 'light' }, @{ $rows[1] });
$table->add_row({ bottom => 'double' }, @{ $rows[2] });

is "\n" . $table->render, <<END_BOX, "Lines in between rows";

\x{2552}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2555}
\x{2502} id \x{2502} ts                  \x{2502} log                 \x{2502}
\x{255e}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2561}
\x{2502}  1 \x{2502} 2012-04-16 12:34:16 \x{2502} blakblkj welkjwe    \x{2502}
\x{251c}\x{2500}\x{2500}\x{2500}\x{2500}\x{253c}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{253c}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2524}
\x{2502}  2 \x{2502} 2012-04-16 16:30:43 \x{2502} Eric was here       \x{2502}
\x{251c}\x{2500}\x{2500}\x{2500}\x{2500}\x{253c}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{253c}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2500}\x{2524}
\x{2502}  3 \x{2502} 2012-04-16 16:31:43 \x{2502} Eric was here again \x{2502}
\x{2558}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{255b}
END_BOX

$table = Text::UnicodeBox::Table->new();

$table->add_header({ top => 'double', bottom => 'double' }, @columns);
$table->add_row(1, '2012-04-16 12:34:16', "\x{8c61}\x{5f62}\x{6587}\x{5b57}\x{8c61}\x{5f62}\x{6587}\x{5b57}");
$table->add_row({ bottom => 'double' }, @{ $rows[1] });

is "\n" . $table->render, <<END_BOX, "Unicode table data";

\x{2552}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2555}
\x{2502} id \x{2502} ts                  \x{2502} log              \x{2502}
\x{255e}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2561}
\x{2502}  1 \x{2502} 2012-04-16 12:34:16 \x{2502} \x{8c61}\x{5f62}\x{6587}\x{5b57}\x{8c61}\x{5f62}\x{6587}\x{5b57} \x{2502}
\x{2502}  2 \x{2502} 2012-04-16 16:30:43 \x{2502} Eric was here    \x{2502}
\x{2558}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{255b}
END_BOX

$table = Text::UnicodeBox::Table->new( style => 'horizontal_double' );

$table->add_header({ alignment => [ 'left', 'right', 'right' ] }, @columns);
$table->add_row(@$_) foreach @rows;

is "\n" . $table->render, <<END_BOX, "Custom alignment";

\x{2552}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2555}
\x{2502} id \x{2502} ts                  \x{2502} log                 \x{2502}
\x{255e}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2561}
\x{2502} 1  \x{2502} 2012-04-16 12:34:16 \x{2502}    blakblkj welkjwe \x{2502}
\x{2502} 2  \x{2502} 2012-04-16 16:30:43 \x{2502}       Eric was here \x{2502}
\x{2502} 3  \x{2502} 2012-04-16 16:31:43 \x{2502} Eric was here again \x{2502}
\x{2558}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{255b}
END_BOX

$table = Text::UnicodeBox::Table->new( style => 'horizontal_double' );

$table->add_header({
	header_alignment => [ 'left', 'right', 'right' ],
	alignment => [ 'left', 'right', 'right' ],
}, @columns);
$table->add_row(@$_) foreach @rows;

is "\n" . $table->render, <<END_BOX, "Custom alignment";

\x{2552}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2564}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2555}
\x{2502} id \x{2502}                  ts \x{2502}                 log \x{2502}
\x{255e}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{256a}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2561}
\x{2502} 1  \x{2502} 2012-04-16 12:34:16 \x{2502}    blakblkj welkjwe \x{2502}
\x{2502} 2  \x{2502} 2012-04-16 16:30:43 \x{2502}       Eric was here \x{2502}
\x{2502} 3  \x{2502} 2012-04-16 16:31:43 \x{2502} Eric was here again \x{2502}
\x{2558}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2567}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{2550}\x{255b}
END_BOX

done_testing;
